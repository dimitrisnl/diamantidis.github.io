<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><title>Modifying UI elements with Xcode and LLDB v2</title><!-- Begin Jekyll SEO tag v2.5.0 -->
<meta name="generator" content="Jekyll v3.7.4" />
<meta property="og:title" content="Modifying UI elements with Xcode and LLDB v2" />
<meta name="author" content="Ioannis Diamantidis" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Modifying UI elements with Xcode and LLDB v2 (Aliases, Python and Chisel)" />
<meta property="og:description" content="Modifying UI elements with Xcode and LLDB v2 (Aliases, Python and Chisel)" />
<link rel="canonical" href="https://diamantidis.github.io/2018/10/14/modifying-ui-elements-with-xcode-and-lldb-v2" />
<meta property="og:url" content="https://diamantidis.github.io/2018/10/14/modifying-ui-elements-with-xcode-and-lldb-v2" />
<meta property="og:site_name" content="Ioannis Diamantidis" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-10-14T06:02:00+00:00" />
<script type="application/ld+json">
{"description":"Modifying UI elements with Xcode and LLDB v2 (Aliases, Python and Chisel)","@type":"BlogPosting","headline":"Modifying UI elements with Xcode and LLDB v2","dateModified":"2018-10-14T06:02:00+00:00","datePublished":"2018-10-14T06:02:00+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://diamantidis.github.io/2018/10/14/modifying-ui-elements-with-xcode-and-lldb-v2"},"url":"https://diamantidis.github.io/2018/10/14/modifying-ui-elements-with-xcode-and-lldb-v2","author":{"@type":"Person","name":"Ioannis Diamantidis"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link rel="apple-touch-icon" href="/assets/apple-touch-icon.png"/>
<link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png">
<link rel="manifest" href="/assets/site.webmanifest">
<link rel="mask-icon" href="assets/safari-pinned-tab.svg" color="#5bbad5">
<link rel="shortcut icon" href="/assets/favicon.ico">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/browserconfig.xml">
<meta name="theme-color" content="#ffffff"><link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet"><link type="application/atom+xml" rel="alternate" href="https://diamantidis.github.io/feed.xml" title="Ioannis Diamantidis" /><script>
if(!(window.doNotTrack === "1" || navigator.doNotTrack === "1" || navigator.doNotTrack === "yes" || navigator.msDoNotTrack === "1")) {
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-121787430-1', 'auto');
  ga('send', 'pageview');
  ga('set', 'anonymizeIp', true);
}
</script>
  
</head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">
      <h1>Ioannis Diamantidis</h1>
    </a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about" title="About">About</a><a class="page-link" href="/archive" title="Archive">Archive</a><a class="page-link" href="/tags" title="Tags">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1>
      <span class="post-title">Modifying UI elements with Xcode and LLDB v2</span>
    </h1>
    <div class="post-meta">
      <span class="post-date">
        October 14, 2018
      </span>
      <span class="post-divider">-</span>
      <span class="post-minutes">
        
        
          5 minute read
        
      </span>
      <span class="post-divider">-</span>
      <div class="post-tags">
        
          <a class="post-tag" href="/tags#iOS">iOS</a>
        
          <a class="post-tag" href="/tags#Xcode">Xcode</a>
        
          <a class="post-tag" href="/tags#LLDB">LLDB</a>
        
          <a class="post-tag" href="/tags#Python">Python</a>
        
      </div>
    </div>
  </header>

  <div class="post-content">
    <p>In a <a href="/2018/09/30/modifying-ui-elements-with-lldb">previous post</a>, I wrote an introduction about the use of LLDB expressions to modify the UI elements. In this post, I will continue on the same topics and I will focus on how to get the most out of the LLDB expressions. 
No tool will ever work and get user adoption if it is too complicated. 
For this reason, I will write about a number of alternatives to make LLDB expressions easier to use.</p>

<h2 id="command-aliases">Command aliases</h2>
<p>First and foremost, having to type (or copy) a command of this length (e.g <code class="highlighter-rouge">po [[[UIApplication sharedApplication] keyWindow] recursiveDescription]</code>) may discourage developers from using these LLDB commands. Fortunately, there is a solution to this problem.</p>

<p>It is called <code class="highlighter-rouge">Command Aliases</code>.
The only thing needed is to edit a file located in the directory <code class="highlighter-rouge">~/.lldbinit</code>(or create it if not there, by typing <code class="highlighter-rouge">touch ~/.lldbinit</code>) and add the commands like:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">command alias </span>views expression <span class="nt">-l</span> objc <span class="nt">-O</span> <span class="nt">--</span> <span class="o">[[[</span>UIApplication sharedApplication] keyWindow] recursiveDescription]

<span class="nb">command alias </span>flush expression <span class="nt">-l</span> objc <span class="nt">--</span> <span class="o">(</span>void<span class="o">)[</span>CATransaction flush]
<span class="nb">command </span>regex change_color <span class="s1">'s/(.+) (.+)/e (void)[(id)%1 setBackgroundColor:[UIColor %2]]/'</span>
</code></pre></div></div>

<p>The first two commands are already described in the previous post. The first one is to print the view hierarchy and from there get the memory address of the button, and the second one is to refresh the UI.</p>

<p>The last one is an example of how to use <code class="highlighter-rouge">regex</code> to create a command with parameters. In this particular case, a memory address and the name of the color (blueColor) is expected. As an outcome, the background color of the button will change.
For example, running <code class="highlighter-rouge">change_color 0x7f9f7e40cd70  blueColor</code> and <code class="highlighter-rouge">flush</code> will result in changing the background color of the button to blue.</p>

<p>Making use of the aliases will improve the possibility of using this tool, but there are cases where more advanced aliases are needed.
Let’s say, how to find the button’s memory address by the text of the button label.</p>

<p>In such cases, Python comes to the rescue to provide extendability.</p>

<h2 id="lldb-and-python">LLDB and Python</h2>

<p>An easy way to start writing a python command is to use the Xcode console and just type <code class="highlighter-rouge">command script add help</code> and follow the instructions.</p>

<p><img src="https://diamantidis.github.io/assets/lldb2/script_add_help_commmand.png" alt="command script add help screenshot" /></p>

<p>Alternatively, you can create a script file, that can be added to the repo and a version control system, and then run the command <code class="highlighter-rouge">command script import &lt;script_file_path&gt;</code> on the Xcode console or better add it to the <code class="highlighter-rouge">~/.lldbinit</code> file.</p>

<p>To write a python function that will be used as a new LLDB command, a function that takes four arguments should be implemented:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">command_function</span><span class="p">(</span><span class="n">debugger</span><span class="p">,</span> <span class="n">command</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">internal_dict</span><span class="p">):</span>
    <span class="c"># Your code goes here</span>
</code></pre></div></div>

<p>The type and the description of each of these variables, according to the <a href="https://lldb.llvm.org/python-reference.html">LLDB python reference</a>, is the following:</p>

<ul>
  <li><code class="highlighter-rouge">debugger</code> (type: <code class="highlighter-rouge">lldb.SBDebugger</code>): The current debugger object.</li>
  <li><code class="highlighter-rouge">command</code> (type: <code class="highlighter-rouge">python string</code>): A python string containing all arguments for your command. If you need to chop up the arguments try using the shlex module’s shlex.split(command) to properly extract the arguments.</li>
  <li><code class="highlighter-rouge">result</code> (type: <code class="highlighter-rouge">lldb.SBCommandReturnObject</code>): A return object which encapsulates success/failure information for the command and output text that needs to be printed as a result of the command. The plain Python “print” command also works but text won’t go in the result by default (it is useful as a temporary logging facility).</li>
  <li><code class="highlighter-rouge">internal_dict</code> (type: <code class="highlighter-rouge">python dict object</code>): The dictionary for the current embedded script session which contains all variables and functions.</li>
</ul>

<p>If you are using the <code class="highlighter-rouge">command script import</code> approach, you can define the function <code class="highlighter-rouge">__lldb_init_module</code> like below:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">__lldb_init_module</span><span class="p">(</span><span class="n">debugger</span><span class="p">,</span> <span class="n">internal_dict</span><span class="p">):</span>
    <span class="c"># Command Initialization code goes here</span>
    <span class="n">debugger</span><span class="o">.</span><span class="n">HandleCommand</span><span class="p">(</span><span class="s">'command script add -f filter.filter_button_by_label filter_button_by_label'</span><span class="p">)</span>
</code></pre></div></div>
<p>where debugger and internal_dict are as above.</p>

<p>This function will get called when the module is loaded allowing you to add whatever commands you want into the current debugger.</p>

<p>The description of the argument of the <code class="highlighter-rouge">debugger.HandleCommand</code> is the following:</p>

<ul>
  <li><code class="highlighter-rouge">command script add</code>: LLDB command to add a script.</li>
  <li><code class="highlighter-rouge">-f argument</code>: Specifies the name of the Python function that the command will execute. It follows the format <code class="highlighter-rouge">{module name}.{function name}</code>.<br />
In the example above:
    <ul>
      <li><code class="highlighter-rouge">filter</code>: is the name of the module (in Python is just the file name without the .py extension)</li>
      <li><code class="highlighter-rouge">filter_button_by_label</code>: is the command function. (the one described previously as <code class="highlighter-rouge">command_function(debugger, command, result, internal_dict)</code>)</li>
    </ul>
  </li>
  <li><code class="highlighter-rouge">last argument</code> (for example, <code class="highlighter-rouge">filter_button_by_label</code>): is the command that will be used in the Xcode console to invoke this function.</li>
</ul>

<p>The full example can be found in the following gist:</p>

<script src="https://gist.github.com/d95531fd571c360078fcc795d1967ded.js?file=filter.py"> </script>

<p>This is an example of how to get the memory address of a button from the text of the button label. It can be called like <code class="highlighter-rouge">filter_button_by_label -n "Press me"</code> and it will return the memory address of that button.</p>

<p>So the whole flow of changing the color of a button has changed to:</p>

<p><img src="https://diamantidis.github.io/assets/lldb2/final_commands.png" alt="final flow to change button screenshot" /></p>

<p>which is much shorter and easier to remember and therefore use compared to the first implementation.</p>

<h2 id="chisel"><a href="https://github.com/facebook/chisel">Chisel</a></h2>
<p>Above all these, there is already an open sourced collection of LLDB commands provided by Facebook, named <a href="https://github.com/facebook/chisel">Chisel</a>.
It provides a plethora of commands that probably solves most of the problems any iOS developer may face.</p>

<blockquote>
  <p>Hint: If you find Chisel interesting and you would like to contribute or somehow redistribute it, spend some time reading the <a href="https://github.com/facebook/chisel/blob/master/CONTRIBUTING.md">contributing documentation</a> and the <a href="https://github.com/facebook/chisel/blob/master/LICENSE">license</a>.</p>
</blockquote>

<p>Two of my favourite commands are the following:</p>

<ul>
  <li><code class="highlighter-rouge">findinstances</code> which can be used to find instances of specified ObjC classes, and</li>
  <li><code class="highlighter-rouge">pcurl</code> which can be used to print the NSURLRequest as curl command, that can later be used for debugging purposes.</li>
</ul>

<h2 id="conclusion">Conclusion</h2>

<p>That’s it for now!! I chose to write those two posts regarding LLDB expressions, because I am an advocate of always trying to improve the workflow and remove some of the burdens that come “by default” with each tool.</p>

<p>Furthermore, I decided to follow this flow and not just mention the final solution or just a tool, because digging deeper and understanding how the tools work and how they are built has each own benefits. Reinventing the wheel is not always the right approach to solve some problems, but most of the time is at least educational and enjoyable. Last but not least, by acquiring this knowledge, someone not only makes his life easier when working on UI changes, but also can improve his skills in other areas (e.g. LLDB, Python) and ultimately get a greater confidence on his skills and the ability to overcome any problems that may arise.</p>

<blockquote>
  <p>There is nothing impossible to him who will try.</p>
  <ul>
    <li>Alexander the Great</li>
  </ul>
</blockquote>

  </div>

  <div class="share">
    <strong>Share: </strong>
    
      
      
        <a href="//twitter.com/share?text=Modifying+UI+elements+with+Xcode+and+LLDB+v2&url=https%3A%2F%2Fdiamantidis.github.io%2F2018%2F10%2F14%2Fmodifying-ui-elements-with-xcode-and-lldb-v2"
          onclick="window.open(this.href, 'twitter-share', 'width=550,height=255');return false;">
          <span class="fa-stack fa-lg">
              <i class="fa fa-circle fa-stack-2x"></i>
              <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
          </span>
        </a>
      
      
      
    
      
      
      
        <a href="//www.facebook.com/sharer.php?t=Modifying+UI+elements+with+Xcode+and+LLDB+v2&u=https%3A%2F%2Fdiamantidis.github.io%2F2018%2F10%2F14%2Fmodifying-ui-elements-with-xcode-and-lldb-v2"
          onclick="window.open(this.href, 'facebook-share', 'width=550,height=255');return false;">
          <span class="fa-stack fa-lg">
              <i class="fa fa-circle fa-stack-2x"></i>
              <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
          </span>
        </a>
      
      
    
      
      
      
      
        <a href="//www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fdiamantidis.github.io%2F2018%2F10%2F14%2Fmodifying-ui-elements-with-xcode-and-lldb-v2"
          onclick="window.open(this.href, 'linkedin-share', 'width=550,height=255');return false;">
              <span class="fa-stack fa-lg">
              <i class="fa fa-circle fa-stack-2x"></i>
              <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
          </span>
        </a>
      
    
  </div><div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = 'https://diamantidis.github.io/2018/10/14/modifying-ui-elements-with-xcode-and-lldb-v2';
      this.page.identifier = 'https://diamantidis.github.io/2018/10/14/modifying-ui-elements-with-xcode-and-lldb-v2';
    };

    (function() {
      var d = document, s = d.createElement('script');

      s.src = 'https://ioannisblog-1.disqus.com/embed.js';

      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript></article>

      </div>
    </main><footer class="site-footer">
	<data class="u-url" href="/"></data>

  	<div class="footer-icons">
   		<ul>
    		



<li>
	<a href="https://github.com/diamantidis">
		<span class="fa-stack fa-lg">
            <i class="fa fa-circle fa-stack-2x"></i>
            <i class="fa fa-github fa-stack-1x fa-inverse"></i>
        </span>
	</a>
</li>


<li>
	<a href="http://linkedin.com/in/ioannis-diamantidis-04413273">
		<span class="fa-stack fa-lg">
            <i class="fa fa-circle fa-stack-2x"></i>
            <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
        </span>
	</a>
</li>



<li>
	<a href="/feed.xml">
		<span class="fa-stack fa-lg">
            <i class="fa fa-circle fa-stack-2x"></i>
            <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
        </span>
	</a>
</li>




<li>
	<a href="mailto:diamantidis@outlook.com">
		<span class="fa-stack fa-lg">
            <i class="fa fa-circle fa-stack-2x"></i>
            <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
        </span>
	</a>
</li>


    	</ul>
  	</div>
  	<div class="wrapper">
    	<p>Built with 
    		<i class="fa fa-heart" aria-hidden="true"></i>, <a href="https://jekyllrb.com/">Jekyll</a> and <a href="https://pages.github.com/"> Github Pages</a>
    	</p>
  		<p> © Copyright 2019 Ioannis Diamantidis </p>	
  	</div>
</footer>
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script>
<script>
	window.addEventListener("load", function(){
		window.cookieconsent.initialise({
			"palette": {
				"popup": {
					"background": "#B0C4DE"
				},
				"button": {
				    "background": "#f1d600"
				}
			},
			"content": {
				"message": "This website uses cookies to ensure you get the best experience and to provide the comment feature.",
    			"href": "/cookie_policy"
  			}
		})
	});

</script></body>

</html>
